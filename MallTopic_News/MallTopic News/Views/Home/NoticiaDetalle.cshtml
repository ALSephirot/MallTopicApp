@{
	ViewBag.Title = "Home Page";
}
@model MallTopic_News.Models.Noticias
@using MallTopic_News.Controllers;
@using System.Web.Script.Serialization;

@{
	MallTopic_News.Controllers.ConsumirWebApi ca = new MallTopic_News.Controllers.ConsumirWebApi();
	var modelo = Newtonsoft.Json.JsonConvert.DeserializeObject<MallTopic_News.Models.Noticias>(ca.Peticion("Noticias/" + Convert.ToString(@Html.DisplayFor(model => model.id))));
	var idcategoria = modelo.fk_idcategoria;
	var ModeloCategorias = Newtonsoft.Json.JsonConvert.DeserializeObject<MallTopic_News.Models.Noticias[]>(ca.Peticion("NoticiasDestacadas_Result/false/true/" + idcategoria));


}

<script src="~/Scripts/SliderMT.js"></script>

<section class="notaDetail">
	<h1>@modelo.titulo</h1>

	<section class="SliderNotas">
		<img id="Imagen" data-ocultar="true" data-count="0" class="imagenSliderNotas" />
		<div class="listaMin2">
			<div class="controlesDiv2">
				<a style="cursor: pointer;" onclick="Atras()" ></a>
				<a style="cursor: pointer;" onclick="Siguiente()"></a>
			</div>

			<ul id="miniaturas" class="miniaturas2">
				@{

					var SubsImg = "";
					var Imagenes = modelo.imagenes;
					if (Imagenes != null)
					{
						SubsImg = Imagenes.Substring(0, 1);
					}


					var detalle = "Home/NoticiaDetalle";
					var img = "";
					if (SubsImg == "[")
					{
						var AImagenes = Newtonsoft.Json.JsonConvert.DeserializeObject<MallTopic_News.Models.ImagenesNoticias[]>(modelo.imagenes);
						var c = 0;
						foreach (var item in AImagenes)
						{
							img = "http://malltopic.azurewebsites.net/Images/Uploads/MallTopicNews/" + item.id + ".png";
							if (Existente.RemoteFileExists(img, 500))
							{
								img = "http://malltopic.azurewebsites.net/Images/Uploads/MallTopicNews/" + item.id + ".png";	
							}else
							{
								img = "http://malltopic.azurewebsites.net/Images/Uploads/MallTopicNews/" + item.id + ".jpg";
							}
							

							if (c == 0)
							{

								<li data-select="true" onclick="CambiarImagen(this)"><img src="@img" id="@item.id" data-count="@c" data-src="@img" data-nombreimagen="@item.nombre" data-pieimagen="@item.pie" data-descripcionnoticia="" data-linknoticia="@detalle/@item.id" data-titulo="@item.nombre" /></li>
							}
							else
							{
								<li data-select="false" onclick="CambiarImagen(this)"><img src="@img" id="@item.id" data-count="@c" data-src="@img" data-nombreimagen="@item.nombre" data-pieimagen="@item.pie" data-descripcionnoticia="" data-linknoticia="@detalle/@item.id" data-titulo="@item.nombre" /></li>
							}
							c++;
						}
					}
					else if (SubsImg == "{")
					{
						var AImagen = Newtonsoft.Json.JsonConvert.DeserializeObject<MallTopic_News.Models.ImagenesNoticias>(modelo.imagenes);
						img = "http://malltopic.azurewebsites.net/Images/Uploads/MallTopicNews/" + AImagen.id + ".png";
						if (Existente.RemoteFileExists(img,500))
						{
							img = "http://malltopic.azurewebsites.net/Images/Uploads/MallTopicNews/" + AImagen.id + ".png";
						}
						else
						{
							img = "http://malltopic.azurewebsites.net/Images/Uploads/MallTopicNews/" + AImagen.id + ".jpg";
						}
						<li data-select="true" onclick="CambiarImagen(this)"><img id="@AImagen.id" data-count="0" data-src="@img" src="@img" alt="Alternate Text" data-nombreimagen="@AImagen.nombre" data-pieimagen="@AImagen.pie" data-descripcionnoticia="" data-linknoticia="@detalle/@AImagen.id" data-titulo="@AImagen.nombre" /></li>
					}
					if (SubsImg == "")
					{
						img = "http://malltopic.azurewebsites.net/Images/Uploads/MallTopicNews/" + modelo.id + ".png";
						if (Existente.RemoteFileExists(img, 500))
						{
							img = "http://malltopic.azurewebsites.net/Images/Uploads/MallTopicNews/" + modelo.id + ".png";	
						}
						else
						{
							img = "http://malltopic.azurewebsites.net/Images/Uploads/MallTopicNews/" + modelo.id + ".jpg";
						}
						<li data-select="true" onclick="CambiarImagen(this)"><img id="@modelo.id" data-count="0" data-src="@img" src="@img" alt="Alternate Text" /></li>
					}



				}
			</ul>


		</div>
	</section>
	<h6 id="PieImagen" data-ocultar="true"></h6>
	@{
		if (modelo.descripcion != null)
		{
			var descripciones = modelo.descripcion.Replace("[", "<b>");
			descripciones = descripciones.Replace("]", "</b>");
			descripciones = descripciones.Replace("*", "<br/><br/>");
			<div class="parrafoNota" id="parrafoNota">@descripciones</div>
		}
	}
	

	<script>
		var p = $('#parrafoNota');
		$('#parrafoNota').html(p.text());
	</script>

	

	<article class="relacionadas">
		<h3>Notas relacionadas</h3>
		@foreach (var item in ModeloCategorias)
		{
			if (item.id == Model.id)
			{
			}
			else
			{
				img = "http://malltopic.azurewebsites.net/Images/Uploads/MallTopicNews/" + item.id + ".png";
				if (MallTopic_News.Controllers.Existente.RemoteFileExists(img, 500))
				{
					img = "http://malltopic.azurewebsites.net/Images/Uploads/MallTopicNews/" + item.id + ".png";
				}
				else
				{
					img = "http://malltopic.azurewebsites.net/Images/Uploads/MallTopicNews/" + item.id + ".jpg";
				}
				<a href="@item.id">
					<div class="notasRelac">
						<img src="@img" />
						<h4>@item.titulo</h4>
						
					</div>
				</a>
			}
		}
	</article>
</section>
